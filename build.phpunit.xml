<project name="phpunit">
    <property name="builddir" value="${basedir}/build/"/>
    <property name="phpunit" value="${basedir}/vendor/bin/phpunit"/>

    <target name="prepare">
        <delete dir="${builddir}/coverage"/>
        <mkdir dir="${builddir}/coverage"/>
    </target>
    
    <target name="check-phpunit" depends="prepare">
        <available file="${builddir}/phpunit.xml" property="phpunit.present"/>
    </target>

    <target name="execute"
            depends="check-phpunit"
            description="Run unit tests with PHPUnit"
            if="phpunit.present">
        <exec executable="${phpunit}" resultproperty="result.phpunit" failonerror="true">
            <arg value="--configuration"/> 
            <arg path="${builddir}/phpunit.xml"/>
        </exec>
    </target>

    <target name="execute-no-coverage"
            depends="check-phpunit"
            description="Run unit tests with PHPUnit (without generating code coverage reports)"
            if="phpunit.present">
        <exec executable="${phpunit}" failonerror="true">
            <arg value="--configuration"/>
            <arg path="${builddir}/phpunit.xml"/>
            <arg value="--no-coverage"/>
        </exec>
    </target>
</project>
