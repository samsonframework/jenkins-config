<project name="symfony" default="execute">

    <property name="symfony.target_parameters" value="${basedir}/app/config/parameters_test.yml"/>

    <property name="symfony.bin_dir" value="app"/>
    <property name="symfony.need.assetic-dump" value="true"/>
    

    <target name="prepare" description="Prepare Symfony parameters">
        <exec executable="cp">
            <arg value="-f"></arg>
            <arg value="${symfony.target_parameters}"/>
            <arg value="${basedir}/app/config/parameters.yml"></arg>
        </exec>
    </target>

    <target name="migrate" depends="prepare" description="Migrate">
        <exec executable="php">
            <arg value="app/console"/>
            <arg value="doctrine:migrations:migrate"/>
            <arg value="--no-interaction"></arg>
        </exec>
    </target>

    <target name="cache-clear" description="Clear cache">
        <delete dir="${basedir}/app/cache/prod"/>
        <delete dir="${basedir}/app/cache/test"/>
    </target>

    <target name="is.symfony.need.assetic-dump">
        <condition property="is.symfony.need.assetic-dump">
            <equals arg1="${symfony.need.assetic-dump}" arg2="true"/>
        </condition>
    </target>
    
    <target name="assetic-dump"
            description="Assetic dump"
            depends="is.symfony.need.assetic-dump"
            if="is.symfony.need.assetic-dump">
        <exec executable="php">
            <arg value="${symfony.bin_dir}/console"/>
            <arg value="assetic:dump"/>
            <arg value="--env=prod"/>
            <arg value="--no-debug"/>
        </exec>
    </target>

    <target name="translations-import" description="Import translations">
        <exec executable="php">
            <arg value="${symfony.bin_dir}/console"/>
            <arg value="lexik:translations:import"/>
            <arg value="--case-insensitive"/>
            <arg value="-g"/>
            <arg value="-c"/>
        </exec>
    </target>

    <target
        name="execute"
        depends="prepare,migrate,cache-clear,assetic-dump,translations-import"
        description="Running symfony commands"
    />

</project>
